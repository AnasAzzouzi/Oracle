--Création de la base de
données et contraintes
d’intégrité
--Q1
create table DEPT 
(
DEPTNO number(3) constraint pkDeptNo primary key,

DNAME varchar(50) check (DNAME in ('ACCOUNTING','RESEARCH','SALES','OPERATIONS')),

LOC varchar(50));

--Q2
insert into DEPT VALUES(10,'ACCOUNTING','NEW-YORK');

insert into DEPT VALUES(20,'RESEARCH','DALLAS');

insert into DEPT VALUES(30,'SALES','CHICAGO');

insert into DEPT VALUES(40,'OPERATIONS','BOSTON');

--Q3

CREATE TABLE EMP AS SELECT * FROM SCOTT.EMP

--Q4

INSERT INTO EMP VALUES (7369,'Bidon',NULL,NULL,NULL,NULL,NULL,NULL) 
--ça fonctionne mais ce n'est pas normal car il existe deja un employee avec le meme empno

--Q5
ROLLBACK

--Q6
 ALTER TABLE EMP ADD 
 
CONSTRAINT PK_EMPNO PRIMARY KEY(EMPNO)

 
 
 ALTER TABLE EMP ADD
 CONSTRAINT FK_DEPTNO_DEPTNO 
FOREIGN KEY (DEPTNO)
 
REFERENCES DEPT(DEPTNO)

--Q7

INSERT INTO EMP VALUES(7369, 'WILSON', 'MANAGER', 7839, '17/11/91', 3500.00, 600.00, 10) 
INSERT INTO EMP VALUES (7657, 'WILSON','MANAGER', 7839, '17/11/91', 3500.00, 600.00, 50) 
INSERT INTO EMP VALUES(7657, 'WILSON', 'MANAGER', 7000,'17/11/91', 3500.00, 600.00, 10) 
INSERT INTO EMP VALUES(7657, 'WILSON', 'MANAGER', 7839, '17/11/91', 3500.00,600.00, 10)
--L'employee avec deptno=50 ne s'insert pas car il n ya aucun Dept avec deptno=50
--le deuxieme employee avec empno=7657 ne s'insert pas car il existe deja un employee avec ce empno

--Q8

ALTER TABLE EMP

DISABLE CONSTRAINT PK_EMPNO CASCADE



ALTER TABLE EMP

DISABLE CONSTRAINT FK_DEPTNO_DEPTNO CASCADE

INSERT INTO EMP VALUES (7657, 'WILSON','MANAGER', 7839, '17/11/91', 3500.00, 600.00, 50)
INSERT INTO EMP VALUES(7657, 'WILSON', 'MANAGER', 7839, '17/11/91', 3500.00,600.00, 10)

ALTER TABLE EMP

ENABLE CONSTRAINT PK_EMPNO CASCADE



ALTER TABLE EMP

ENABLE CONSTRAINT FK_DEPTNO_DEPTNO CASCADE

commit 
--Mise à jour de la base de données

--Q1
UPDATE DEPT set LOC='PITTSBURGH' WHERE DNAME='SALES'

--Q2

UPDATE EMP SET sal=sal+sal*0.1 where comm>sal*0.5

--Q3
UPDATE EMP SET comm=(select avg(sal) from emp) where comm is null and hiredate<'01-JAN-82'

--Q4
rollback 
 
--Q5

DELETE FROM DEPT WHERE DEPTNO=20


--Interrogation de la base de données

--Q1
SELECT ENAME ,SAL ,COMM,SAL+COMM FROM EMP WHERE JOB='SALESMAN'

--Q2
SELECT ENAME ,ROUND(COMM/SAL,2) AS RATIO FROM EMP WHERE JOB='SALESMAN' ORDER BY RATIO ASC

--Q3
SELECT ENAME FROM EMP WHERE COMM<SAL*0.25

--Q4
SELECT COUNT(*) FROM EMP WHERE DEPTNO=10

--Q5
SELECT COUNT(*) FROM EMP WHERE NOT NVL(COMM,0)=0

--Q6
SELECT  COUNT(DISTINCT JOB) FROM EMP

--Q7
SELECT JOB ,AVG(SAL) FROM EMP GROUP BY JOB

--Q8
SELECT AVG(E.SAL) FROM EMP E ,DEPT D  WHERE E.DEPTNO=D.DEPTNO AND DNAME='SALES'  

--Q9
SELECT AVG(E.SAL) FROM EMP E ,DEPT D  WHERE E.DEPTNO=D.DEPTNO

--Q10
SELECT ENAME,JOB,SAL FROM EMP  WHERE ROWNUM=1 ORDER BY SAL DESC

--Q11
SELECT ENAME FROM EMP WHERE SAL>(SELECT SAL FROM EMP WHERE ENAME='JONES')

--Q12
SELECT ENAME FROM EMP WHERE JOB=(SELECT JOB FROM EMP WHERE ENAME='JONES')

--Q13
SELECT ENAME FROM EMP WHERE MGR IN (SELECT MGR FROM EMP WHERE ENAME='CLARK')

--Q14


